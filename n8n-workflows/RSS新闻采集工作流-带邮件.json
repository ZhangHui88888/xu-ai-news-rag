{
  "name": "RSSæ–°é—»é‡‡é›†å·¥ä½œæµ-æœ€ç»ˆç‰ˆ",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [0, 0],
      "id": "5281fd69-72f3-4243-9bc6-d253150c28ba",
      "name": "æ‰‹åŠ¨è§¦å‘"
    },
    {
      "parameters": {
        "jsCode": "const rssSources = [\n  {\n    id: 1,\n    name: 'å°‘æ•°æ´¾',\n    url: 'https://sspai.com/feed'\n  }\n];\n\nreturn rssSources.map(source => ({ json: source }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [224, 0],
      "id": "38c368be-4bc9-4d46-8467-2b8178de1984",
      "name": "RSSæºåˆ—è¡¨"
    },
    {
      "parameters": {
        "url": "={{$json.url}}",
        "options": {}
      },
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1.1,
      "position": [448, 0],
      "id": "c631f1e3-e0d6-42b5-83a6-721b7f9c6f1a",
      "name": "è¯»å–RSS"
    },
    {
      "parameters": {
        "url": "={{$json.link}}",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [672, 0],
      "id": "1ea4b23b-aebc-447c-add1-32e20171552a",
      "name": "è·å–HTML"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const httpResponse = $json;\nconst rssData = $('è¯»å–RSS').item.json;\n\nlet html = httpResponse.data || httpResponse.body || httpResponse.response || '';\nif (typeof html === 'object') {\n  html = html.body || html.data || JSON.stringify(html);\n}\nhtml = String(html || '');\n\nlet content = '';\nif (html && html.length > 100) {\n  let cleanHtml = html\n    .replace(/<script[^>]*>.*?<\\/script>/gis, '')\n    .replace(/<style[^>]*>.*?<\\/style>/gis, '')\n    .replace(/<!--.*?-->/gs, '');\n  \n  const articleMatch = cleanHtml.match(/<article[^>]*>(.*?)<\\/article>/is);\n  if (articleMatch) {\n    cleanHtml = articleMatch[1];\n  }\n  \n  content = cleanHtml\n    .replace(/<[^>]+>/g, ' ')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&[a-z]+;/gi, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n  \n  if (content.length > 5000) {\n    content = content.substring(0, 5000) + '...';\n  }\n}\n\nif (!content || content.length < 50) {\n  content = rssData.description || rssData.contentSnippet || 'æ— å†…å®¹';\n}\n\nreturn {\n  title: rssData.title || 'æ— æ ‡é¢˜',\n  content: content,\n  sourceUrl: rssData.link || '',\n  publishedAt: rssData.isoDate || rssData.pubDate || new Date().toISOString(),\n  author: rssData.creator || rssData.author || 'Unknown',\n  tags: rssData.categories || []\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [880, 0],
      "id": "3610424b-d740-46d5-8f59-091f9158df7d",
      "name": "æå–å†…å®¹"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://192.168.171.1:11434/api/generate",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "qwen3:0.6b"
            },
            {
              "name": "prompt",
              "value": "=è¯·ä¸ºä»¥ä¸‹æ–°é—»ç”Ÿæˆä¸€ä¸ªç®€æ´çš„ä¸­æ–‡æ‘˜è¦(ä¸è¶…è¿‡200å­—):\\n\\næ ‡é¢˜:{{ $json.title }}\\n\\nå†…å®¹:{{ $json.content }}\\n\\nåªè¿”å›æ‘˜è¦å†…å®¹,ä¸è¦å…¶ä»–è¯´æ˜ã€‚"
            },
            {
              "name": "stream",
              "value": false
            }
          ]
        },
        "options": {
          "timeout": 60000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1104, 0],
      "id": "4f27cdcf-d92e-4ce0-b3dd-b903f7c199ec",
      "name": "AIç”Ÿæˆæ‘˜è¦"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const aiResponse = $json;\nconst originalData = $('æå–å†…å®¹').item.json;\n\nlet summary = '';\nif (aiResponse.response && typeof aiResponse.response === 'string') {\n  summary = aiResponse.response.trim();\n}\n\nreturn {\n  title: originalData.title,\n  content: originalData.content,\n  summary: summary,\n  sourceUrl: originalData.sourceUrl,\n  publishedAt: originalData.publishedAt,\n  author: originalData.author,\n  tags: originalData.tags || [],\n  contentType: 'news',\n  dataSource: 'RSS'\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1328, 0],
      "id": "e3516f2c-a1f2-4861-a599-470c9ed545aa",
      "name": "å¤„ç†ç»“æœ"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://backend:8080/api/knowledge/import",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1552, 0],
      "id": "32ff88ec-b8f1-4235-90d3-2da767c2a305",
      "name": "ä¿å­˜åˆ°åç«¯"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst successCount = items.filter(item => \n  (item.json.statusCode === 200 || item.json.code === 200)\n).length;\n\nreturn {\n  timestamp: new Date().toISOString(),\n  total: items.length,\n  successCount: successCount,\n  failedCount: items.length - successCount,\n  message: `RSSé‡‡é›†å®Œæˆ: æˆåŠŸ ${successCount}/${items.length} æ¡`\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1760, 0],
      "id": "269e3de0-c582-4510-9fb6-6bf3f6ca4d2d",
      "name": "ç»Ÿè®¡ç»“æœ"
    },
    {
      "parameters": {
        "jsCode": "// æ”¶é›†é‡‡é›†çš„æ–‡ç« ä¿¡æ¯\nconst processedItems = $('å¤„ç†ç»“æœ').all();\nconst stats = $json;\n\n// æå–æ–‡ç« åˆ—è¡¨\nconst articles = processedItems.map(item => ({\n  title: item.json.title || 'æ— æ ‡é¢˜',\n  summary: item.json.summary || 'æ— æ‘˜è¦',\n  sourceUrl: item.json.sourceUrl || '#',\n  publishedAt: item.json.publishedAt || '',\n  author: item.json.author || 'æœªçŸ¥'\n})).slice(0, 10);  // æœ€å¤šæ˜¾ç¤º10ç¯‡\n\nconsole.log('æ”¶é›†åˆ°çš„æ–‡ç« æ•°:', articles.length);\n\nreturn {\n  stats: stats,\n  articles: articles,\n  totalArticles: processedItems.length\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1960, 0],
      "id": "collect-articles-info",
      "name": "æ”¶é›†æ–‡ç« ä¿¡æ¯"
    },
    {
      "parameters": {
        "jsCode": "// æ„å»ºHTMLé‚®ä»¶å†…å®¹\nconst data = $json;\nconst stats = data.stats;\nconst articles = data.articles;\n\nconst html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <style>\n    body { font-family: 'Microsoft YaHei', Arial, sans-serif; background: #f5f7fa; padding: 20px; margin: 0; }\n    .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.1); }\n    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }\n    .header h1 { margin: 0; font-size: 28px; }\n    .stats { padding: 20px; background: #ecf5ff; display: flex; justify-content: space-around; }\n    .stat-item { text-align: center; }\n    .stat-number { font-size: 32px; font-weight: bold; color: #409eff; }\n    .stat-label { color: #666; margin-top: 5px; }\n    .articles { padding: 20px; }\n    .article-item { border-left: 4px solid #409eff; padding: 15px; margin-bottom: 15px; background: #f9f9f9; border-radius: 4px; }\n    .article-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 8px; }\n    .article-title a { color: #409eff; text-decoration: none; }\n    .article-title a:hover { text-decoration: underline; }\n    .article-summary { color: #666; line-height: 1.6; margin-bottom: 8px; }\n    .article-meta { font-size: 12px; color: #999; }\n    .footer { padding: 20px; text-align: center; color: #999; border-top: 1px solid #eee; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>ğŸ“° XU-News AI-RAG é‡‡é›†æŠ¥å‘Š</h1>\n      <p style=\"margin: 10px 0 0; opacity: 0.9;\">${new Date().toLocaleString('zh-CN')}</p>\n    </div>\n    \n    <div class=\"stats\">\n      <div class=\"stat-item\">\n        <div class=\"stat-number\">${stats.total}</div>\n        <div class=\"stat-label\">å¤„ç†æ€»æ•°</div>\n      </div>\n      <div class=\"stat-item\">\n        <div class=\"stat-number\" style=\"color: #67c23a;\">${stats.successCount}</div>\n        <div class=\"stat-label\">æˆåŠŸå…¥åº“</div>\n      </div>\n      <div class=\"stat-item\">\n        <div class=\"stat-number\" style=\"color: #f56c6c;\">${stats.failedCount}</div>\n        <div class=\"stat-label\">å¤±è´¥æ•°é‡</div>\n      </div>\n    </div>\n    \n    <div class=\"articles\">\n      <h2 style=\"color: #333; border-bottom: 2px solid #409eff; padding-bottom: 10px; margin-top: 0;\">ğŸ“š æœ¬æ¬¡é‡‡é›†å†…å®¹ (å…±${articles.length}ç¯‡)</h2>\n      ${articles.map((article, index) => `\n        <div class=\"article-item\">\n          <div class=\"article-title\">\n            ${index + 1}. <a href=\"${article.sourceUrl}\" target=\"_blank\">${article.title}</a>\n          </div>\n          <div class=\"article-summary\">${article.summary}</div>\n          <div class=\"article-meta\">\n            ğŸ‘¤ ${article.author} | ğŸ“… ${new Date(article.publishedAt).toLocaleString('zh-CN')}\n          </div>\n        </div>\n      `).join('')}\n    </div>\n    \n    <div class=\"footer\">\n      <p>ğŸ¤– XU-News AI-RAG è‡ªåŠ¨åŒ–æ–°é—»é‡‡é›†ç³»ç»Ÿ</p>\n      <p>è®¿é—®ç³»ç»Ÿ: <a href=\"http://192.168.171.128:5173\" style=\"color: #409eff;\">http://192.168.171.128:5173</a></p>\n    </div>\n  </div>\n</body>\n</html>\n`;\n\nreturn {\n  html: html,\n  subject: `ğŸ“° RSSé‡‡é›†æŠ¥å‘Š - æˆåŠŸ${stats.successCount}æ¡ | ${new Date().toLocaleDateString('zh-CN')}`,\n  stats: stats,\n  articleCount: articles.length\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2160, 0],
      "id": "build-html-email",
      "name": "æ„å»ºHTMLé‚®ä»¶"
    },
    {
      "parameters": {
        "sendTo": "652364972@qq.com",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.html }}",
        "options": {
          "contentType": "html"
        }
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [2360, 0],
      "id": "send-email-notification",
      "name": "å‘é€é‚®ä»¶",
      "credentials": {
        "smtp": {
          "id": "smtp-qq",
          "name": "QQé‚®ç®±SMTP"
        }
      }
    }
  ],
  "connections": {
    "æ‰‹åŠ¨è§¦å‘": {
      "main": [[{"node": "RSSæºåˆ—è¡¨", "type": "main", "index": 0}]]
    },
    "RSSæºåˆ—è¡¨": {
      "main": [[{"node": "è¯»å–RSS", "type": "main", "index": 0}]]
    },
    "è¯»å–RSS": {
      "main": [[{"node": "è·å–HTML", "type": "main", "index": 0}]]
    },
    "è·å–HTML": {
      "main": [[{"node": "æå–å†…å®¹", "type": "main", "index": 0}]]
    },
    "æå–å†…å®¹": {
      "main": [[{"node": "AIç”Ÿæˆæ‘˜è¦", "type": "main", "index": 0}]]
    },
    "AIç”Ÿæˆæ‘˜è¦": {
      "main": [[{"node": "å¤„ç†ç»“æœ", "type": "main", "index": 0}]]
    },
    "å¤„ç†ç»“æœ": {
      "main": [[{"node": "ä¿å­˜åˆ°åç«¯", "type": "main", "index": 0}]]
    },
    "ä¿å­˜åˆ°åç«¯": {
      "main": [[{"node": "ç»Ÿè®¡ç»“æœ", "type": "main", "index": 0}]]
    },
    "ç»Ÿè®¡ç»“æœ": {
      "main": [[{"node": "æ”¶é›†æ–‡ç« ä¿¡æ¯", "type": "main", "index": 0}]]
    },
    "æ”¶é›†æ–‡ç« ä¿¡æ¯": {
      "main": [[{"node": "æ„å»ºHTMLé‚®ä»¶", "type": "main", "index": 0}]]
    },
    "æ„å»ºHTMLé‚®ä»¶": {
      "main": [[{"node": "å‘é€é‚®ä»¶", "type": "main", "index": 0}]]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": []
}

