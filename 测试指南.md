# XU-News-AI-RAG 测试指南

## 📋 环境要求

### 必需环境
- **Java**: JDK 17 或更高版本
- **Maven**: 3.6+ 
- **Node.js**: 18+
- **MySQL**: 8.0+
- **Docker & Docker Compose**（可选，推荐用于快速部署）

### 检查环境
```bash
# 检查 Java 版本
java -version

# 检查 Maven 版本
mvn -version

# 检查 Node 版本
node -v

# 检查 MySQL
mysql --version

# 检查 Docker（可选）
docker --version
docker-compose --version
```

---

## 🐳 方式一：Docker Compose 部署（推荐）

### 1. 启动所有服务

```bash
# 在项目根目录执行
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看后端日志
docker-compose logs -f backend
```

### 2. 等待服务启动

服务启动顺序：
1. ✅ MySQL (约10秒)
2. ✅ Ollama (约20秒)  
3. ✅ n8n (约15秒)
4. ✅ 后端服务 (约30秒)

### 3. 访问服务

- **后端 API**: http://localhost:8080/api
- **API 文档**: http://localhost:8080/api/docs (Swagger UI)
- **n8n 工作流**: http://localhost:5678 (用户名: admin, 密码: admin123)
- **Ollama API**: http://localhost:11434
- **MySQL**: localhost:3306 (root/xu_news_2025)

### 4. 初始化 Ollama 模型

```bash
# 下载 Qwen2.5 模型（大约 2GB）
docker exec -it xu-news-ollama ollama pull qwen2.5:3b

# 下载嵌入模型
docker exec -it xu-news-ollama ollama pull all-minilm-l6-v2

# 验证模型
docker exec -it xu-news-ollama ollama list
```

### 5. 停止服务

```bash
# 停止所有服务
docker-compose down

# 停止并删除数据卷（慎用！）
docker-compose down -v
```

---

## 💻 方式二：本地开发部署

### 步骤 1：准备数据库

```bash
# 登录 MySQL（密码：592802）
mysql -u root -p592802

# 创建数据库
CREATE DATABASE IF NOT EXISTS xu_news_rag DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 退出
exit

# 导入初始化脚本
mysql -u root -p592802 xu_news_rag < database/init.sql

# 验证数据库
mysql -u root -p592802 -e "USE xu_news_rag; SHOW TABLES;"
```

### 步骤 2：启动后端服务

```bash
# 进入后端目录
cd backend

# 安装依赖并编译
mvn clean install -DskipTests

# 启动后端（开发环境）
mvn spring-boot:run

# 或者指定配置文件
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

后端应该在 http://localhost:8080 启动成功。

### 步骤 3：启动前端服务

```bash
# 打开新终端，进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

前端应该在 http://localhost:5173 启动成功。

### 步骤 4：启动 Ollama（可选）

```bash
# 如果需要 AI 功能，启动 Ollama
# Windows: 下载安装 Ollama for Windows
# https://ollama.ai/download

# macOS/Linux:
curl -fsSL https://ollama.ai/install.sh | sh

# 下载模型
ollama pull qwen2.5:3b
ollama pull all-minilm-l6-v2

# 验证
ollama list
```

### 步骤 5：启动 n8n（可选）

```bash
# 使用 Docker 启动 n8n
docker run -d \
  --name xu-news-n8n \
  -p 5678:5678 \
  -e N8N_BASIC_AUTH_ACTIVE=true \
  -e N8N_BASIC_AUTH_USER=admin \
  -e N8N_BASIC_AUTH_PASSWORD=admin123 \
  -v n8n_data:/home/node/.n8n \
  n8nio/n8n

# 访问 http://localhost:5678
```

---

## 🧪 API 测试

### 1. 测试用户注册

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "Test123456",
    "fullName": "测试用户"
  }'
```

**预期响应：**
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com"
    }
  }
}
```

### 2. 测试用户登录

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "Test123456"
  }'
```

**保存返回的 token**，后续请求需要使用。

### 3. 测试知识库查询（需要 token）

```bash
# 将 YOUR_TOKEN 替换为登录返回的 token
curl -X GET "http://localhost:8080/api/knowledge/list?page=1&size=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 4. 测试文件上传

```bash
# 上传一个文档文件
curl -X POST http://localhost:8080/api/knowledge/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@/path/to/your/document.pdf" \
  -F "tags=[\"测试\",\"文档\"]"
```

### 5. 测试 AI 问答（需要 Ollama）

```bash
curl -X POST http://localhost:8080/api/query/ask \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "question": "最近有什么科技新闻？",
    "topK": 5
  }'
```

---

## 🌐 前端页面测试

1. **访问首页**: http://localhost:5173
2. **注册账号**: 点击"注册"按钮
3. **登录系统**: 使用注册的账号登录
4. **浏览知识库**: 查看新闻和文档列表
5. **智能搜索**: 输入关键词搜索
6. **AI 问答**: 在聊天界面提问
7. **上传文档**: 上传 PDF/Word/TXT 文件

---

## 🔍 故障排查

### 后端启动失败

**1. 检查端口占用**
```bash
# Windows
netstat -ano | findstr :8080

# macOS/Linux
lsof -i :8080
```

**2. 检查数据库连接**
```bash
# 测试数据库连接
mysql -u root -p592802 -h localhost -P 3306 xu_news_rag -e "SELECT 1;"
```

**3. 查看后端日志**
```bash
# 日志文件位置
tail -f backend/logs/xu-news-rag.log
```

### 前端启动失败

**1. 清除缓存重新安装**
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
```

**2. 检查环境变量**
```bash
# 查看 vite.config.js 中的代理配置
cat vite.config.js
```

### Docker 相关问题

**1. 查看容器日志**
```bash
# 查看所有容器状态
docker-compose ps

# 查看特定容器日志
docker-compose logs backend
docker-compose logs mysql
docker-compose logs ollama
```

**2. 重启容器**
```bash
# 重启特定服务
docker-compose restart backend

# 重启所有服务
docker-compose restart
```

**3. 进入容器调试**
```bash
# 进入后端容器
docker exec -it xu-news-backend sh

# 进入 MySQL 容器
docker exec -it xu-news-mysql mysql -u root -pxu_news_2025
```

### 数据库问题

**1. 检查数据库是否创建**
```bash
mysql -u root -p592802 -e "SHOW DATABASES LIKE 'xu_news_rag';"
```

**2. 检查表结构**
```bash
mysql -u root -p592802 xu_news_rag -e "SHOW TABLES;"
```

**3. 重置数据库**
```bash
mysql -u root -p592802 -e "DROP DATABASE IF EXISTS xu_news_rag;"
mysql -u root -p592802 < database/init.sql
```

---

## 📊 性能测试（可选）

### 使用 Apache Bench 测试

```bash
# 安装 ab (Apache Bench)
# macOS: brew install httpd
# Ubuntu: apt-get install apache2-utils

# 测试登录接口 - 100个请求，10个并发
ab -n 100 -c 10 -p login.json -T application/json \
  http://localhost:8080/api/auth/login

# login.json 内容：
# {"username":"testuser","password":"Test123456"}
```

### 使用 JMeter 测试

1. 下载 Apache JMeter
2. 创建测试计划
3. 添加 HTTP 请求采样器
4. 配置线程组（用户数、循环次数）
5. 运行测试并查看结果

---

## 📝 测试清单

- [ ] 后端服务启动成功（端口 8080）
- [ ] 前端服务启动成功（端口 5173）
- [ ] MySQL 数据库连接正常
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] JWT Token 验证正常
- [ ] 知识库列表查询正常
- [ ] 文件上传功能正常
- [ ] Ollama AI 模型加载成功（可选）
- [ ] AI 问答功能正常（可选）
- [ ] n8n 工作流正常（可选）
- [ ] 前端页面渲染正常
- [ ] 前后端接口联调正常

---

## 🎯 下一步

测试通过后，您可以：

1. **开发新功能**: 基于现有架构扩展
2. **导入 n8n 工作流**: 使用 `n8n-workflows/rss-news-collector.json`
3. **自定义 AI 模型**: 训练或微调 Ollama 模型
4. **部署到生产**: 使用 Docker Compose 或 Kubernetes
5. **配置 HTTPS**: 添加 Nginx 反向代理和 SSL 证书

---

## 🆘 获取帮助

- 查看项目文档: `README.md`
- 查看 API 文档: http://localhost:8080/api/docs
- 查看技术架构: `技术架构文档-XU-News-AI-RAG.md`

---

**祝测试顺利！🎉**

